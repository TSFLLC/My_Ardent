----use this for KPI's galery

Items
With(
    {
        _base:
        Filter(
            'kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        )
    },
    SortByColumns(
        Filter(
            _base,
            IsBlank(varPillar) || Pillar = varPillar,
            IsBlank(txtSearch.Text) ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(KPIsText,""))) > 0 ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(ObjectivesText,""))) > 0 ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(PrioritiesText,""))) > 0
        ),
        "Pillar",
        SortOrder.Ascending
    )
)




------------------------step by step------------------------.

0) Prereqs (what you already have)

Data sources:

'kpi.Department'

'kpi.Pillar'

'kpi.vKPI_OnePagerUX' ← includes KPIYear

'kpi.vKPI_Years' ← list of KPIYear

App.OnStart (from earlier) is fine; you don’t need to change it again.

1) Filters (done) + add a search box

Insert → Text input → rename to txtSearch

Default: ""

HintText: "Search KPI / Objective / Priority"

You’ll wire this into the gallery filter in step 3.

2) (Optional) Pillar selector (left column)

Insert → Gallery (Vertical) → rename galPillars

Items

Distinct(
    Filter(
        'kpi.vKPI_OnePagerUX',
        DeptCode = ddDept.Selected.DeptCode,
        KPIYear  = ddYear.Selected.KPIYear,
        Quarter  = ddQuarter.Selected.Value
    ),
    Pillar
)


Inside the gallery, set the label Text = ThisItem.Result

OnSelect (of the gallery template):

Set(varPillar, If(varPillar = ThisItem.Result, Blank(), ThisItem.Result))


(Optional) TemplateFill to highlight selection:

If(ThisItem.Result = varPillar, RGBA(0,0,0,0.06), RGBA(0,0,0,0))

3) Main KPI list (center column)

Insert → Gallery (Vertical) → rename galKPIs

Items

// Base filter from dropdowns
With(
    {
        _base:
        Filter(
            'kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        )
    },
    // Optional pillar filter + search + sort
    SortByColumns(
        Filter(
            _base,
            IsBlank(varPillar) || Pillar = varPillar,
            IsBlank(txtSearch.Text) ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(KPIsText,""))) > 0 ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(ObjectivesText,""))) > 0 ||
                Find(Lower(txtSearch.Text), Lower(Coalesce(PrioritiesText,""))) > 0
        ),
        "Pillar",    // primary sort (change if you prefer)
        SortOrder.Ascending
    )
)


Inside galKPIs, add labels:

Title:
ThisItem.Pillar & " • " & ThisItem.ObjectivesText

Subtitle:
"Priority: " & ThisItem.PrioritiesText

Body:
"KPI: " & ThisItem.KPIsText

Footer (small):
"Dept: " & ThisItem.Department & " | Year: " & ThisItem.KPIYear & " | Q: " & ThisItem.Quarter & " | Leader: " & ThisItem.Leader

If your gallery shows too much text, turn Wrap on for labels (Advanced → AutoHeight = true).

4) KPI detail screen (drill-in)

Insert → Screen → rename scrKPIDetail.
On galKPIs.TemplateFill or a chevron/icon inside the template:

OnSelect

Set(varKPI, ThisItem);
Navigate(scrKPIDetail, ScreenTransition.Cover)


On scrKPIDetail, add labels bound to varKPI:

Header: varKPI.Pillar

Subheader: "Dept: " & varKPI.Department & " | Year: " & varKPI.KPIYear & " | Q: " & varKPI.Quarter

Objective: varKPI.ObjectivesText

Priority: varKPI.PrioritiesText

KPI: varKPI.KPIsText

Leader: varKPI.Leader

Add a Back icon:

OnSelect: Back()

5) Summary chips (top of the screen)

Insert three Labels across the top:

Total KPIs

"KPIs: " &
CountRows(
    Filter(
        'kpi.vKPI_OnePagerUX',
        DeptCode = ddDept.Selected.DeptCode,
        KPIYear  = ddYear.Selected.KPIYear,
        Quarter  = ddQuarter.Selected.Value
    )
)


Objectives (distinct)

"Objectives: " &
CountRows(
    Distinct(
        Filter(
            'kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        ),
        ObjectivesText
    )
)


Priorities (distinct)

"Priorities: " &
CountRows(
    Distinct(
        Filter(
            'kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        ),
        PrioritiesText
    )
)

6) Optional: sort switcher

Insert a Drop down named ddSortBy

Items: ["Pillar","Objectives","Priorities","KPI"]

Default: "Pillar"

Update galKPIs.Items outer SortByColumns to:

SortByColumns(
    Filter( /* same filter as step 3 */ ),
    Switch(
        ddSortBy.Selected.Value,
        "Pillar",       "Pillar",
        "Objectives",   "ObjectivesText",
        "Priorities",   "PrioritiesText",
        /* default */   "KPIsText"
    ),
    SortOrder.Ascending
)

7) Optional: capture selections as variables (for export, deep links)

On each dropdown’s OnChange:

// ddDept.OnChange
Set(varDept, ddDept.Selected.DeptCode);

// ddYear.OnChange
Set(varYearSel, ddYear.Selected.KPIYear);

// ddQuarter.OnChange
Set(varQuarterSel, ddQuarter.Selected.Value);

8) Troubleshooting checklist

If a control turns red, hover for the exact message. It’s usually a field name mismatch—use the JSON trick again to confirm column names.

If the gallery returns no rows, test the base filter alone (copy just the inner Filter(...) into a label with CountRows(...)).

For huge datasets, keep using the wrapper views (vKPI_OnePagerUX, vKPI_Years)—that keeps your dropdowns fully delegable and snappy.

3333333333333333333333333333333333333333333333333333333

SortByColumns(
  Filter(
    'kpi.vKPI_OnePagerUX',
    DeptCode = ddDept.Selected.DeptCode,
    KPIYear  = ddYear.Selected.KPIYear,
    Quarter  = ddQuarter.Selected.Value
  ),
  "Pillar",
  SortOrder.Ascending
)

Set(varPillar, Blank());        // no pillar selected yet
Set(varSearchText, "");         // empty search by default

//////////////////////////////////////////////////////////////////////////////////////////////////////
1) Tidy the KPI gallery (galKPIs)

Inside galKPIs, add labels with these formulas:

Title
ThisItem.Pillar & " • " & ThisItem.ObjectivesText

Subtitle
"Priority: " & ThisItem.PrioritiesText

Body
"KPI: " & ThisItem.KPIsText

Footer (small)
"Dept: " & ThisItem.Department & " | Year: " & ThisItem.KPIYear & " | Q: " & ThisItem.Quarter & " | Leader: " & ThisItem.Leader

Tips: set labels to AutoHeight = true and Wrap = true. Adjust TemplateSize for readability (e.g., 140–180).

2) Add a quick text search (optional but useful)

Insert → Text input → rename txtSearch → HintText: “Search KPI / Objective / Priority”.

Update galKPIs.Items to include search:

With(
    {
        base:
        Filter(
            'kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        )
    },
    SortByColumns(
        If(
            IsBlank(Trim(txtSearch.Text)),
            base,
            Filter(
                base,
                Find(Lower(Trim(txtSearch.Text)), Lower(Coalesce(KPIsText,""))) > 0
                || Find(Lower(Trim(txtSearch.Text)), Lower(Coalesce(ObjectivesText,""))) > 0
                || Find(Lower(Trim(txtSearch.Text)), Lower(Coalesce(PrioritiesText,""))) > 0
            )
        ),
        "Pillar",
        SortOrder.Ascending
    )
)


(If you prefer not to add search yet, keep your current Items.)

3) Add summary chips (counts)

Insert three labels at the top of the screen:

// Total KPIs
"KPIs: " &
CountRows(
    Filter('kpi.vKPI_OnePagerUX',
        DeptCode = ddDept.Selected.DeptCode,
        KPIYear  = ddYear.Selected.KPIYear,
        Quarter  = ddQuarter.Selected.Value
    )
)

// Distinct Objectives
"Objectives: " &
CountRows(
    Distinct(
        Filter('kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        ),
        ObjectivesText
    )
)

// Distinct Priorities
"Priorities: " &
CountRows(
    Distinct(
        Filter('kpi.vKPI_OnePagerUX',
            DeptCode = ddDept.Selected.DeptCode,
            KPIYear  = ddYear.Selected.KPIYear,
            Quarter  = ddQuarter.Selected.Value
        ),
        PrioritiesText
    )
)

4) Drill-in detail screen

Insert → Screen → rename scrKPIDetail.

In galKPIs, add a chevron icon; OnSelect:

Set(varKPI, ThisItem);
Navigate(scrKPIDetail, ScreenTransition.Cover)


On scrKPIDetail, add labels bound to varKPI:

Header: varKPI.Pillar

Subheader: "Dept: " & varKPI.Department & " | Year: " & varKPI.KPIYear & " | Q: " & varKPI.Quarter

Objective: varKPI.ObjectivesText

Priority: varKPI.PrioritiesText

KPI: varKPI.KPIsText

Leader: varKPI.Leader

Add a Back icon → OnSelect: Back()

5) No-results empty state (polish)

Add a label over the gallery; set Visible to:

CountRows(galKPIs.AllItems) = 0


Set Text to:

"No results. Adjust Department, Year, or Quarter (or clear Search)."

6) Optional: sort selector

Add classic Drop down named ddSortBy

Items: ["Pillar","Objectives","Priorities","KPI"]

Default: "Pillar"

Update galKPIs.Items outer sort:

SortByColumns(
  /* your filtered table */,
  Switch(
    ddSortBy.Selected.Value,
    "Pillar",       "Pillar",
    "Objectives",   "ObjectivesText",
    "Priorities",   "PrioritiesText",
    /* default */   "KPIsText"
  ),
  SortOrder.Ascending
)

7) Quick refresh button (data reload)

Insert a Button → Text: “Refresh”. OnSelect:

Refresh('kpi.Department');
Refresh('kpi.vKPI_Years');
Refresh('kpi.vKPI_OnePagerUX');

8) Final sanity checks

Change Dept/Year/Quarter and verify counts + list change.

Type in txtSearch and confirm filtered results.

Click a KPI → detail page shows the correct record.

That’s it—this gives you a working, demo-ready KPI browser with filters, search, counts, and a detail view. If you want, I can package these steps and formulas into a clean Word guide you can hand to your manager.
